(()=>{"use strict";var e={d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};function t(e){e.classList.add("popup_is-opened","popup_is-animated"),document.addEventListener("keydown",o),e.addEventListener("mousedown",r)}function n(e){e.classList.remove("popup_is-animated","popup_is-opened"),document.removeEventListener("keydown",o),e.removeEventListener("mousedown",r)}function o(e){if("Escape"===e.key){var t=document.querySelector(".popup_is-opened");t&&n(t)}}function r(e){e.target.classList.contains("popup")&&n(e.target)}e.d({},{V:()=>N});var c={baseUrl:"https://nomoreparties.co/v1/wff-cohort-42",headers:{authorization:"cd3e0860-0fa9-42ef-8229-a70984b89014","Content-Type":"application/json"}},a=document.querySelector("#card-template").content;function i(e,t,n,o){var r=a.cloneNode(!0).querySelector(".card"),c=r.querySelector(".card__like-counter"),i=r.querySelector(".card__like-button"),s=r.querySelector(".card__delete-button"),u=r.querySelector(".card__image");return u.src=e.link,u.alt=e.name,r.querySelector(".card__title").textContent=e.name,e.owner._id===N?s.addEventListener("click",(function(){return t(r,e._id)})):s.remove(),e.likes.some((function(e){return e._id===N}))&&i.classList.add("card__like-button_is-active"),c.textContent=e.likes.length,i.addEventListener("click",(function(){return n(i,e._id,c)})),u.addEventListener("click",(function(){return o(e.link,e.name)})),r}var s,u,l=function(e,t){(function(e){return fetch("".concat(c.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:c.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))})(t).then((function(){e.remove()})).catch((function(e){console.error("Ошибка удаления карточки",e)}))},d=function(e,t,n){var o=e.classList.contains("card__like-button_is-active")?function(e){return fetch("".concat(c.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:c.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(t):function(e){return fetch("".concat(c.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:c.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(t),r=parseInt(n.textContent);e.classList.toggle("card__like-button_is-active"),o.then((function(t){n.textContent=t.likes.length;var o=t.likes.some((function(e){return e._id===N}));e.classList.toggle("card__like-button_is-active",o)})).catch((function(t){console.error("Ошибка при обновлении лайка",t),e.classList.toggle("card__like-button_is-active"),n.textContent=r}))},p=function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),o&&(o.textContent="",o.classList.remove(n.errorClass))},f=function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);n.forEach((function(n){p(e,n,t),n.setCustomValidity("")})),o.disabled=!0,o.classList.add(t.inactiveButtonClass)},m=function(e,t,n){var o=n.inactiveButtonClass,r=e.some((function(e){return!e.validity.valid}));t.disabled=r,t.classList.toggle(o,r)},_=document.querySelector(".places__list"),v=document.querySelector(".profile__add-button"),h=document.querySelector(".profile__edit-button"),y=document.querySelectorAll(".popup__close"),b=document.querySelector(".popup_type_new-card"),S=document.querySelector(".popup_type_edit"),C=document.querySelector(".popup_type_new-avatar"),k=document.forms["new-place"],L=k.elements["place-name"],q=k.elements.link,E=document.forms["new-avatar"],g=E.elements.avatar,x=document.querySelector(".profile__title"),j=document.querySelector(".profile__description"),P=document.querySelector(".profile__image"),w=document.forms["edit-profile"],U=w.elements.name,A=w.elements.description,O=document.querySelector(".popup_type_image"),T=O.querySelector(".popup__image"),B=O.querySelector(".popup__caption"),D={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},N="";fetch("".concat(c.baseUrl,"/users/me"),{headers:c.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){x.textContent=e.name,j.textContent=e.about,P.style.backgroundImage="url('".concat(e.avatar,"')"),N=e._id,e.name})).catch((function(e){console.error("Ошибка при загрузке профиля:",e)})),fetch("".concat(c.baseUrl,"/cards"),{headers:c.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){e.forEach((function(e){var t=i(e,l,d,V);_.appendChild(t)}))})).catch((function(e){console.error("Ошибка при загрузке карточек",e)})),u=(s=D).formSelector,Array.from(document.querySelectorAll(u)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);n.forEach((function(r){r.addEventListener("input",(function(){!function(e,t,n){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?p(e,t,n):function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o.inputErrorClass),r&&(r.textContent=n,r.classList.add(o.errorClass))}(e,t,t.validationMessage,n)}(e,r,t),m(n,o,t)}))}))}(e,s)})),f(k,D),f(E,D);var V=function(e,n){T.src=e,T.alt=n,B.textContent=n,t(O)};k.addEventListener("submit",(function(e){var t,o,r,a,s,u;e.preventDefault(),(t=L.value,o=q.value,s=k.querySelector(".popup__button"),u=s.textContent,s.textContent="Сохранение...",s.disabled=!0,(r=t,a=o,fetch("".concat(c.baseUrl,"/cards"),{method:"POST",headers:c.headers,body:JSON.stringify({name:r,link:a})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).finally((function(){s.textContent=u,s.disabled=!1}))).then((function(e){var t=i(e,l,d,V);_.prepend(t),n(b),k.reset(),f(k,D)})).catch((function(e){console.error("Ошибка при обработке формы",e)}))})),w.addEventListener("submit",(function(e){var t,o,r,a,i,s;e.preventDefault(),r=w.querySelector(".popup__button"),a=r.textContent,i=U.value,s=A.value,r.textContent="Сохранение...",r.disabled=!0,(t=i,o=s,fetch("".concat(c.baseUrl,"/users/me"),{method:"PATCH",headers:c.headers,body:JSON.stringify({name:t,about:o})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){x.textContent=e.name,j.textContent=e.about,n(S)})).catch((function(e){console.log("Ошибка обновления профиля",e)})).finally((function(){r.textContent=a,r.disabled=!1}))})),E.addEventListener("submit",(function(e){var t,o,r,a;e.preventDefault(),o=E.querySelector(".popup__button"),r=o.textContent,a=g.value,o.textContent="Сохранение...",o.disabled=!0,(t=a,fetch("".concat(c.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:c.headers,body:JSON.stringify({avatar:t})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){P.style.backgroundImage="url('".concat(e.avatar,"')"),n(C),E.reset()})).catch((function(e){console.error("Ошибка при загрузке аватара",e)})).finally((function(){o.textContent=r,o.disabled=!1}))})),v.addEventListener("click",(function(){t(b)})),h.addEventListener("click",(function(){U.value=x.textContent,A.value=j.textContent,f(w,D),t(S)})),P.addEventListener("click",(function(){t(C)})),y.forEach((function(e){e.addEventListener("click",(function(){var t=e.closest(".popup");t&&n(t)}))}))})();